<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>mooding</h1>
    <div class="intro">
      <p>
        Redefiniendo el hardware clásico a través del arte digital. Desde
        ordenadores integrados en lienzos hasta sistemas completos dentro de
        monitores CRT reconvertidos.
      </p>
    </div>

    <section class="carousel" aria-label="Carrusel de imágenes">
      <button class="carousel-arrow" id="prev-btn" aria-label="Imagen anterior">
        &#10094;
      </button>

      <div class="carousel-stage">
        <div class="roulette" id="roulette"></div>
      </div>

      <button
        class="carousel-arrow"
        id="next-btn"
        aria-label="Imagen siguiente"
      >
        &#10095;
      </button>
    </section>

    <script>
      const images = [
        {
          src: "../ideas_imagenes/fondo_provisional.png",
          href: "#",
        },
        {
          src: "../ideas_imagenes/unnamed.jpg",
          href: "#",
        },
        {
          src: "../ideas_imagenes/70s-retro-perspective-lines-background-vintage-colourful-stripes-banner-backdrop-and-wallpaper-vector.jpg",
          href: "#",
        },
        {
          src: "../ideas_imagenes/retro_orbit.svg",
          href: "#",
        },
      ];

      let currentIndex = 0;
      let isAnimating = false;
      const SPIN_MS = 280;
      const RESET_MS = 220;
      const STEP_DELAY_MS = 60;

      const roulette = document.getElementById("roulette");

      function buildRoulette() {
        roulette.innerHTML = "";

        images.forEach((item, index) => {
          const panel = document.createElement("div");
          panel.className = "roulette-panel";
          panel.dataset.index = index;

          const card = document.createElement("div");
          card.className = "roulette-card";

          const img = document.createElement("img");
          img.className = "roulette-image";
          img.src = item.src;
          img.alt = `Imagen ${index + 1}`;

          const overlay = document.createElement("div");
          overlay.className = "roulette-overlay";

          const overlayText = document.createElement("p");
          overlayText.className = "roulette-overlay-text";
          overlayText.textContent = "Leer más";

          const link = document.createElement("a");
          link.className = "learn-more-btn";
          link.href = item.href;
          link.target = "_blank";
          link.rel = "noopener noreferrer";
          link.textContent = "Abrir";

          overlay.append(overlayText, link);
          card.append(img, overlay);
          panel.appendChild(card);

          panel.addEventListener("click", (event) => {
            if (event.target.closest(".learn-more-btn")) return;
            rotateToIndex(index);
          });
          roulette.appendChild(panel);
        });
      }

      function updateFocus() {
        const panels = roulette.querySelectorAll(".roulette-panel");
        const total = images.length;

        panels.forEach((panel, index) => {
          panel.classList.remove("is-active", "is-left", "is-right", "is-back");
          panel.classList.toggle("is-active", index === currentIndex);

          const delta = (index - currentIndex + total) % total;
          if (delta === 1) panel.classList.add("is-right");
          if (delta === total - 1) panel.classList.add("is-left");
          if (delta === 2 || delta === total - 2)
            panel.classList.add("is-back");
        });
      }

      function rotateRoulette(direction) {
        if (isAnimating) return;
        isAnimating = true;

        currentIndex =
          (currentIndex + direction + images.length) % images.length;
        roulette.style.setProperty(
          "--rotation-y",
          direction > 0 ? "-14deg" : "14deg",
        );
        updateFocus();
        setTimeout(() => {
          roulette.style.setProperty("--rotation-y", "0deg");
        }, SPIN_MS);

        setTimeout(() => {
          isAnimating = false;
        }, SPIN_MS + RESET_MS);
      }

      function rotateToIndex(targetIndex) {
        if (isAnimating || targetIndex === currentIndex) return;

        const total = images.length;
        const forward = (targetIndex - currentIndex + total) % total;
        const backward = (currentIndex - targetIndex + total) % total;
        const direction = forward <= backward ? 1 : -1;
        const steps = Math.min(forward, backward);
        if (steps === 0) return;

        let done = 0;
        const spinStep = () => {
          if (done >= steps) return;
          rotateRoulette(direction);
          done += 1;
          if (done < steps) {
            setTimeout(spinStep, SPIN_MS + RESET_MS + STEP_DELAY_MS);
          }
        };
        spinStep();
      }

      document.getElementById("prev-btn").addEventListener("click", () => {
        rotateRoulette(-1);
      });

      document.getElementById("next-btn").addEventListener("click", () => {
        rotateRoulette(1);
      });

      buildRoulette();
      updateFocus();
    </script>
  </body>
</html>
